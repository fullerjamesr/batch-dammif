# batch-dammif
A bash script for launching multiple instances of the SAXS modeling program dammif from the ATSAS software package.

## What's the point
I  created this script as a way to launch multiple instances of dammif as background jobs based on settings I could centralize in a single .in file. The most notable hurdle here was that the random seed used by dammif is set in this file, but I wanted several independent random runs to start at once. This script solves that problem by rewriting the random seed in the .in file each time before launching a new dammif instance.

This script can also start dammif in "slow" mode using default settings (in which case, dammif sets the random seed internally based on system time) or launch interactive sessions in screen sessions.

The outputs from each instance are then named *prefix-n*, where *n* counts upward from 1. Thus the outputs are named in an orderly fashion, and you can launch more dammif instances later after the first batch finishes (the script checks whether a given *prefix-n* has already been launched by looking for *prefix-n.log* in the output directory).
 
My use case for this script is to launch multiple instances of dammif from the same .in and GNOM .out files on multiple workstations on a shared network drive, starting as many instances of dammif on each workstation as there are CPU cores. I repeat this as necessary until I have 10-20 reconstructions.

## Installation
Place batch_dammif.sh somewhere in your $PATH, and make it executable. Easy!

## Dependencies
* This script requires the ["GNU enhanced" version of getopt](http://man7.org/linux/man-pages/man1/getopt.1.html) in order to neatly handle option flags. Most Linux distributions should have this available through their package manager, often in the package "util-linux" (my Centos 6 workstations come with it out of the box). On MacOS, it is available from [homebrew](https://brew.sh) via ```brew install gnu-getopt```. In the proper version, ```getopt --test``` should set ```$?``` to a value >= 4 (this is also tested at the top of the script).
* To manually configure multiple dammif runs interactively, the script will try to run dammif inside multiple instances of [screen](https://www.gnu.org/software/screen/). Most Linux distributions should have screen available through their package managers. My Mac running High Sierra includes screen out of the box.

## Usage
```batch_dammif [options] /path/to/gnomfile.out```
##### Options:
* -n, --num *integer* : The number of instances of dammif to launch (default: 1). 
* -i, --in */path/to/file.in* : A file describing a set of options for dammif (e.g., .in files are generated at the end of successful dammif runs so that that they can be reproduced) (default: none, start with slow mode defaults or in interactive mode according to -m/--mode)
* -m, --mode *[slow* or *interactive]* : In the absence of a file describing dammif settings, dammif can be started using the slow mode defaults or await user input in screen sessions. If a valid input file is specified via the -i/--in option, this setting is ignored. (default: slow)
* -p, --prefix *string* : The prefix for the dammif output files. This also can be used to set the output directory for the files generated by dammif. By default, the prefix and output directory are the same as the GNOM file.
* -b, --bin */path/to/dammif* : Where to find the dammif executable (default: none, assume dammif is in $PATH)

***dammif defaults and input/output files are described in detail at the [dammif manual page](https://www.embl-hamburg.de/biosaxs/manuals/dammif.html).***
